(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function r(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(i){if(i.ep)return;i.ep=!0;const a=r(i);fetch(i.href,a)}})();const u={initialPlantAmount:1e3,initialHerbivoreAmount:500,initialCarnivoreAmount:200,plantGrowthRate:.01,herbivoreConsumptionRate:.005,carnivoreConsumptionRate:.003,naturalDeathRate:1e-4,playerInterventionAmount:50,svgWidth:800,svgHeight:500,pyramidTotalHeight:400,pyramidBaseWidth:600,pyramidTopWidth:50,pyramidPaddingBottom:50,pyramidSegmentColors:{plant:"#4CAF50",herbivore:"#FFC107",carnivore:"#F44336"},dragSensitivity:1};function U(e,t,r,o){e.innerHTML="",_(t,r,o).forEach(a=>{const s=document.createElementNS("http://www.w3.org/2000/svg","polygon");s.setAttribute("points",a.points),s.setAttribute("fill",a.fillColor),s.setAttribute("id",a.id),s.classList.add("pyramid-segment"),s.dataset.type=a.type,e.appendChild(s)})}function _(e,t,r){const o=[],{svgWidth:i,svgHeight:a,pyramidTotalHeight:s,pyramidBaseWidth:A,pyramidTopWidth:B,pyramidPaddingBottom:S,pyramidSegmentColors:b}=u,c=i/2,$=u.initialPlantAmount+u.initialHerbivoreAmount+u.initialCarnivoreAmount,d=e/$*s,g=t/$*s,H=r/$*s,m=a-S,I=ae=>{const se=ae/s;return A-(A-B)*se};let h=0;const w=I(h);h+=d;const C=I(h);o.push({points:`${c-w/2},${m} ${c+w/2},${m} ${c+C/2},${m-d} ${c-C/2},${m-d}`,fillColor:b.plant,id:"segment-plant",type:"plant"});const T=C;h+=g;const G=I(h);o.push({points:`${c-T/2},${m-d} ${c+T/2},${m-d} ${c+G/2},${m-d-g} ${c-G/2},${m-d-g}`,fillColor:b.herbivore,id:"segment-herbivore",type:"herbivore"});const N=G;h+=H;const ie=m-d-g-H;return o.push({points:`${c-N/2},${m-d-g} ${c+N/2},${m-d-g} ${c},${ie}`,fillColor:b.carnivore,id:"segment-carnivore",type:"carnivore"}),o}function ce(e,t,r,o){_(t,r,o).forEach(a=>{const s=e.querySelector(`#${a.id}`);s&&s.setAttribute("points",a.points)})}function M(e,t){const r=document.getElementById("ecosystem-svg");if(r&&(r.querySelectorAll(".pyramid-segment").forEach(o=>{o.classList.remove("hovered")}),e&&t)){const o=r.querySelector(`#segment-${e}`);o&&o.classList.add("hovered")}}function Y(e,t){const r=document.getElementById("ecosystem-svg");if(r&&(r.querySelectorAll(".pyramid-segment").forEach(o=>{o.classList.remove("dragging")}),e&&t)){const o=r.querySelector(`#segment-${e}`);o&&o.classList.add("dragging")}}let n,P,p=null,f=null,k=null;function R(){n={plant:u.initialPlantAmount,herbivore:u.initialHerbivoreAmount,carnivore:u.initialCarnivoreAmount,time:0,isGameOver:!1},P=performance.now(),f&&f(n)}function z(e,t){f=e,k=t,R(),p!==null&&cancelAnimationFrame(p),p=requestAnimationFrame(J)}function le(){p!==null&&(cancelAnimationFrame(p),p=null)}function J(e){if(n.isGameOver){le();return}const t=e-P;P=e,n.time+=t,me(t/1e3),de(),f&&f(n),p=requestAnimationFrame(J)}function me(e){const{plantGrowthRate:t,herbivoreConsumptionRate:r,carnivoreConsumptionRate:o,naturalDeathRate:i}=u,a=n.plant*t*e,s=n.herbivore*r*e;n.plant+=a-s;const A=s*.5,B=n.carnivore*o*e,S=n.herbivore*i*e;n.herbivore+=A-B-S;const b=B*.5,c=n.carnivore*i*e;n.carnivore+=b-c,n.plant=Math.max(0,n.plant),n.herbivore=Math.max(0,n.herbivore),n.carnivore=Math.max(0,n.carnivore)}function v(e,t,r){if(n.isGameOver)return;const i=(r!==void 0?r:u.playerInterventionAmount)*t;switch(e){case"plant":n.plant+=i;break;case"herbivore":n.herbivore+=i;break;case"carnivore":n.carnivore+=i;break}n.plant=Math.max(0,n.plant),n.herbivore=Math.max(0,n.herbivore),n.carnivore=Math.max(0,n.carnivore),f&&f(n)}function de(){(n.plant<=0||n.herbivore<=0||n.carnivore<=0)&&(n.isGameOver=!0,k&&k(n.time))}function V(){return{...n}}const Q="ecosystemGameRanking",F=10;function ue(e){const t=Z();t.push(e),t.sort((r,o)=>o-r),t.length>F&&t.splice(F),localStorage.setItem(Q,JSON.stringify(t))}function Z(){const e=localStorage.getItem(Q);if(e)try{const t=JSON.parse(e);if(Array.isArray(t)&&t.every(r=>typeof r=="number"))return t}catch(t){console.error("Failed to parse ranking from localStorage:",t)}return[]}const l=document.getElementById("ecosystem-svg"),W=document.getElementById("time-display"),x=document.getElementById("restart-button"),q=document.getElementById("ranking-list"),L=document.getElementById("game-over-modal"),X=document.getElementById("final-score"),j=document.getElementById("modal-restart-button"),ve=document.getElementById("plant-increase"),pe=document.getElementById("plant-decrease"),fe=document.getElementById("herbivore-increase"),ge=document.getElementById("herbivore-decrease"),he=document.getElementById("carnivore-increase"),ye=document.getElementById("carnivore-decrease");let y=!1,E=null,O=0;document.addEventListener("DOMContentLoaded",()=>{if(R(),l){const e=V();U(l,e.plant,e.herbivore,e.carnivore),Ee(),ne(e.time),D(),z(ee,te)}else console.error("SVG要素が見つかりません。")});function ee(e){l&&ce(l,e.plant,e.herbivore,e.carnivore),ne(e.time)}function te(e){const t=Math.floor(e/1e3);ue(t),D(),be(t)}function ne(e){const t=Math.floor(e/1e3);W&&(W.textContent=`生存時間: ${t}秒`)}function D(){if(q){const e=Z();q.innerHTML=e.map((t,r)=>`<li>${r+1}. ${t}秒</li>`).join("")}}function be(e){L&&X&&(X.textContent=`あなたの生存時間: ${e}秒`,L.style.display="flex")}function re(){L&&(L.style.display="none")}function K(){R();{const e=V();U(l,e.plant,e.herbivore,e.carnivore)}z(ee,te),re(),D()}function Ee(){ve.removeEventListener("click",()=>v("plant",1)),pe.removeEventListener("click",()=>v("plant",-1)),fe.removeEventListener("click",()=>v("herbivore",1)),ge.removeEventListener("click",()=>v("herbivore",-1)),he.removeEventListener("click",()=>v("carnivore",1)),ye.removeEventListener("click",()=>v("carnivore",-1)),x&&x.addEventListener("click",()=>{K()}),j&&j.addEventListener("click",()=>{re(),K()}),l&&(l.addEventListener("mousemove",Ae),l.addEventListener("mousedown",Be),l.addEventListener("mouseup",Le),l.addEventListener("mouseleave",Se))}function Ae(e){if(y)return;const r=e.target?.dataset.type;r?M(r,!0):M(null,!1)}function Be(e){const r=e.target?.dataset.type;r&&(y=!0,E=r,O=e.clientX,Y(E,!0),l.addEventListener("mousemove",oe))}function Le(){y&&(y=!1,Y(null,!1),l.removeEventListener("mousemove",oe),E=null)}function Se(){y||M(null,!1)}function oe(e){if(!y||!E)return;const r=(e.clientX-O)*u.dragSensitivity,o=r>0?1:-1;v(E,o,Math.abs(r)),O=e.clientX}
